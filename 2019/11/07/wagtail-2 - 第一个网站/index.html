<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="修改后台编辑窗口初始后台管理页面中，页面内容仅包括标题项，可通过以下方式添加其他元素。 新增正文编辑框，可编辑 home/models.py : 12345678910111213from django.db import modelsfrom wagtail.core.models import Pagefrom wagtail.core.fields import RichTextFieldf">
<meta name="keywords" content="wagtail">
<meta property="og:type" content="article">
<meta property="og:title" content="wagtail-2 - 第一个网站">
<meta property="og:url" content="http://yoursite.com/2019/11/07/wagtail-2 - 第一个网站/index.html">
<meta property="og:site_name" content="鱼之乐">
<meta property="og:description" content="修改后台编辑窗口初始后台管理页面中，页面内容仅包括标题项，可通过以下方式添加其他元素。 新增正文编辑框，可编辑 home/models.py : 12345678910111213from django.db import modelsfrom wagtail.core.models import Pagefrom wagtail.core.fields import RichTextFieldf">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-11-18T02:51:22.217Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wagtail-2 - 第一个网站">
<meta name="twitter:description" content="修改后台编辑窗口初始后台管理页面中，页面内容仅包括标题项，可通过以下方式添加其他元素。 新增正文编辑框，可编辑 home/models.py : 12345678910111213from django.db import modelsfrom wagtail.core.models import Pagefrom wagtail.core.fields import RichTextFieldf">
  <link rel="canonical" href="http://yoursite.com/2019/11/07/wagtail-2 - 第一个网站/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>wagtail-2 - 第一个网站 | 鱼之乐</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">鱼之乐</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">子非鱼安知鱼之乐</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/07/wagtail-2 - 第一个网站/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="鱼之乐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鱼之乐">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">wagtail-2 - 第一个网站

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-07 11:31:21" itemprop="dateCreated datePublished" datetime="2019-11-07T11:31:21+08:00">2019-11-07</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-18 10:51:22" itemprop="dateModified" datetime="2019-11-18T10:51:22+08:00">2019-11-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/wagtail系列/" itemprop="url" rel="index"><span itemprop="name">wagtail系列</span></a></span>

                
                
              
            </span>
          

          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    <span class="post-meta-item-text">评论数：</span>
  
    <a href="/2019/11/07/wagtail-2 - 第一个网站/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/11/07/wagtail-2 - 第一个网站/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="修改后台编辑窗口"><a href="#修改后台编辑窗口" class="headerlink" title="修改后台编辑窗口"></a>修改后台编辑窗口</h2><p>初始后台管理页面中，页面内容仅包括标题项，可通过以下方式添加其他元素。</p>
<p>新增正文编辑框，可编辑 home/models.py :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">from wagtail.core.models import Page</span><br><span class="line">from wagtail.core.fields import RichTextField</span><br><span class="line">from wagtail.admin.edit_handlers import FieldPanel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class HomePage(Page):</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        FieldPanel(&apos;body&apos;, classname=&quot;full&quot;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>其中，body为一个富文本窗口（特殊wagtail元素），content_panels定义页面容器。</p>
<p>然后运行</p>
<pre><code>python manage.py makemigrations
python manage.py migrate </code></pre><p>更新数据库。</p>
<p>每次修改代码之后，都需要运行上述代码，以确保功能更新。</p>
<p>现在，通过后台管理页面-&gt;Homepage-&gt;Edit，即可看到新的body页面，编辑正文内容，然后发布此页面。</p>
<h2 id="修改前台展示"><a href="#修改前台展示" class="headerlink" title="修改前台展示"></a>修改前台展示</h2><p>页面发布之后，返回前台首页，发现仅网页标题改了，其他一切未变，这是因为首页的渲染模板是未变。</p>
<p>编辑 home/templates/home/home_page.html ，使其仅包含以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load wagtailcore_tags %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body_class %&#125;template-homepage&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;&#123; page.body|richtext &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>再次刷新首页，即可看到已显示编辑内容，但界面好丑….</p>
<p>Wagtail提供很多模板标签，可通过在模板文件头部添加 <em>load wagtailcore_tags</em> 显式引入模板标签。</p>
<p>本文中，使用富文本框来编辑和输出正文内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load wagtailcore_tags %&#125;</span><br><span class="line">&#123;&#123; page.body|richtext &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>最终在前台页面，会将其渲染为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;rich-text&quot;&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;b&gt;Welcome&lt;/b&gt; to our new site!</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注</strong>: 需要在每一个模板文件中包含 <em>load wagtailcore_tags</em> 来使用Wagtail标签，否则Django将抛出错误<em>TemplateSyntaxError</em>。</p>
<h2 id="简单博客网站"><a href="#简单博客网站" class="headerlink" title="简单博客网站"></a>简单博客网站</h2><p>在wagtail项目根目录下，通过以下代码，在已有wagtail网站中添加一个blog应用：</p>
<pre><code>python manage.py startapp blog</code></pre><p>编辑 mysite/settings/base.py ，在 <em>INSTALLED_APPS</em> 添加 <em>blog</em></p>
<h3 id="博客首页"><a href="#博客首页" class="headerlink" title="博客首页"></a>博客首页</h3><p>通过编辑blog/models.py，定义一个简单的博客首页:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from wagtail.core.models import Page</span><br><span class="line">from wagtail.core.fields import RichTextField</span><br><span class="line">from wagtail.admin.edit_handlers import FieldPanel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BlogIndexPage(Page):</span><br><span class="line">    intro = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        FieldPanel(&apos;intro&apos;, classname=&quot;full&quot;)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>运行以下代码，确保更新</p>
<pre><code>python manage.py makemigrations
python manage.py migrate </code></pre><p>模板文件名为BlogIndexPage，默认的模板文件位于根目录下/mysite/templates/blog/blog_index_page.html。创建此文件，并包含以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load wagtailcore_tags %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body_class %&#125;template-blogindexpage&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;intro&quot;&gt;&#123;&#123; page.intro|richtext &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;% for post in page.get_children %&#125;</span><br><span class="line">        &lt;h2&gt;&lt;a href=&quot;&#123;% pageurl post %&#125;&quot;&gt;&#123;&#123; post.title &#125;&#125;&lt;/a&gt;&lt;/h2&gt;</span><br><span class="line">        &#123;&#123; post.specific.intro &#125;&#125;</span><br><span class="line">        &#123;&#123; post.specific.body|richtext &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>在wagtail后台管理界面，创建BlogIndexPage作为Homepage的子页面，确保Promote页签中slug为blog并发布。</p>
<p>现在，可以通过 <a href="http://localhost:8000/blog/" target="_blank" rel="noopener">http://localhost:8000/blog/</a> 访问你的blog网站。</p>
<h3 id="发布文章页面"><a href="#发布文章页面" class="headerlink" title="发布文章页面"></a>发布文章页面</h3><p>编辑 blog/models.py:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">from wagtail.core.models import Page</span><br><span class="line">from wagtail.core.fields import RichTextField</span><br><span class="line">from wagtail.admin.edit_handlers import FieldPanel</span><br><span class="line">from wagtail.search import index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Keep the definition of BlogIndexPage, and add:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BlogPage(Page):</span><br><span class="line">    date = models.DateField(&quot;Post date&quot;)</span><br><span class="line">    intro = models.CharField(max_length=250)</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    search_fields = Page.search_fields + [</span><br><span class="line">        index.SearchField(&apos;intro&apos;),</span><br><span class="line">        index.SearchField(&apos;body&apos;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        FieldPanel(&apos;date&apos;),</span><br><span class="line">        FieldPanel(&apos;intro&apos;),</span><br><span class="line">        FieldPanel(&apos;body&apos;, classname=&quot;full&quot;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>运行以下代码，确保更新</p>
<pre><code>python manage.py makemigrations
python manage.py migrate </code></pre><p>创建模板文件 mysite/templates/blog/blog_page.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load wagtailcore_tags %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body_class %&#125;template-blogpage&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p class=&quot;meta&quot;&gt;&#123;&#123; page.date &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;intro&quot;&gt;&#123;&#123; page.intro &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;&#123; page.body|richtext &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;&lt;a href=&quot;&#123;&#123; page.get_parent.url &#125;&#125;&quot;&gt;Return to blog&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>可以发布几个博客内容页面，作为博客首页（BlogIndexPage）的子页面，确保创建时选择“Blog Page”类型。 </p>
<p>一个较为简陋的博客系统初步搞定。</p>
<h3 id="排序和发布"><a href="#排序和发布" class="headerlink" title="排序和发布"></a>排序和发布</h3><p>但是，现在博客首页现在还有一些问题：</p>
<ul>
<li>文章按照时间顺序显示，先发布先显示</li>
<li>文章无论是否发布，都显示</li>
</ul>
<p>变更首页文章排序方式，可通过修改blog/models.py，重写BlogIndexPage的get_context()：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class BlogIndexPage(Page):</span><br><span class="line">    intro = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    def get_context(self, request):</span><br><span class="line">        # Update context to include only published posts, ordered by reverse-chron</span><br><span class="line">        context = super().get_context(request)</span><br><span class="line">        blogpages = self.get_children().live().order_by(&apos;-first_published_at&apos;)</span><br><span class="line">        context[&apos;blogpages&apos;] = blogpages</span><br><span class="line">        return context</span><br></pre></td></tr></table></figure>

<p>修改模板blog_index_page.html，将 ‘for post in page.get_children’ 修改为 ‘for post in blogpages’</p>
<p>现在，试着将一片文章取消发布，即可发现它不再显示在博客首页了。同时，显示顺序也变更为时间倒序。</p>
<h2 id="图片支持"><a href="#图片支持" class="headerlink" title="图片支持"></a>图片支持</h2><p>尽管通过富文本框新增图片很容易，但仍然建议将图片作为一个新元素存入数据库，这样的话此图片可独立于当前文章，用在网站任何地方。</p>
<p>在blog/models.py新增BlogPageGalleryImage：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># New imports added for ParentalKey, Orderable, InlinePanel, ImageChooserPanel</span><br><span class="line"></span><br><span class="line">from modelcluster.fields import ParentalKey</span><br><span class="line"></span><br><span class="line">from wagtail.core.models import Page, Orderable</span><br><span class="line">from wagtail.core.fields import RichTextField</span><br><span class="line">from wagtail.admin.edit_handlers import FieldPanel, InlinePanel</span><br><span class="line">from wagtail.images.edit_handlers import ImageChooserPanel</span><br><span class="line">from wagtail.search import index</span><br><span class="line"></span><br><span class="line"># ... (Keep the definition of BlogIndexPage, and update BlogPage:)</span><br><span class="line"></span><br><span class="line">class BlogPage(Page):</span><br><span class="line">    date = models.DateField(&quot;Post date&quot;)</span><br><span class="line">    intro = models.CharField(max_length=250)</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    search_fields = Page.search_fields + [</span><br><span class="line">        index.SearchField(&apos;intro&apos;),</span><br><span class="line">        index.SearchField(&apos;body&apos;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        FieldPanel(&apos;date&apos;),</span><br><span class="line">        FieldPanel(&apos;intro&apos;),</span><br><span class="line">        FieldPanel(&apos;body&apos;, classname=&quot;full&quot;),</span><br><span class="line">        InlinePanel(&apos;gallery_images&apos;, label=&quot;Gallery images&quot;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BlogPageGalleryImage(Orderable):</span><br><span class="line">    page = ParentalKey(BlogPage, on_delete=models.CASCADE, related_name=&apos;gallery_images&apos;)</span><br><span class="line">    image = models.ForeignKey(</span><br><span class="line">        &apos;wagtailimages.Image&apos;, on_delete=models.CASCADE, related_name=&apos;+&apos;</span><br><span class="line">    )</span><br><span class="line">    caption = models.CharField(blank=True, max_length=250)</span><br><span class="line"></span><br><span class="line">    panels = [</span><br><span class="line">        ImageChooserPanel(&apos;image&apos;),</span><br><span class="line">        FieldPanel(&apos;caption&apos;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>运行以下代码，确保更新</p>
<pre><code>python manage.py makemigrations
python manage.py migrate </code></pre><p>通过以上步骤，在新增博客文章页面BlogPage增加了一个图片选项。</p>
<p>修正mysite/templates/blog/blog_page.html，使文章显示页面能够显示图片：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load wagtailcore_tags wagtailimages_tags %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body_class %&#125;template-blogpage&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p class=&quot;meta&quot;&gt;&#123;&#123; page.date &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;intro&quot;&gt;&#123;&#123; page.intro &#125;&#125;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;&#123; page.body|richtext &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% for item in page.gallery_images.all %&#125;</span><br><span class="line">        &lt;div style=&quot;float: left; margin: 10px&quot;&gt;</span><br><span class="line">            &#123;% image item.image fill-320x240 %&#125;</span><br><span class="line">            &lt;p&gt;&#123;&#123; item.caption &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">    &lt;p&gt;&lt;a href=&quot;&#123;&#123; page.get_parent.url &#125;&#125;&quot;&gt;Return to blog&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>通过在blog/models.py的BlogPage中定义main_image，返回文章中首个图片:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class BlogPage(Page):</span><br><span class="line">    date = models.DateField(&quot;Post date&quot;)</span><br><span class="line">    intro = models.CharField(max_length=250)</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line"></span><br><span class="line">    def main_image(self):</span><br><span class="line">        gallery_item = self.gallery_images.first()</span><br><span class="line">        if gallery_item:</span><br><span class="line">            return gallery_item.image</span><br><span class="line">        else:</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">    search_fields = Page.search_fields + [</span><br><span class="line">        index.SearchField(&apos;intro&apos;),</span><br><span class="line">        index.SearchField(&apos;body&apos;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        FieldPanel(&apos;date&apos;),</span><br><span class="line">        FieldPanel(&apos;intro&apos;),</span><br><span class="line">        FieldPanel(&apos;body&apos;, classname=&quot;full&quot;),</span><br><span class="line">        InlinePanel(&apos;gallery_images&apos;, label=&quot;Gallery images&quot;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>更新 blog_index_page.html ，使博客首页包含图片（首张）的显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load wagtailcore_tags wagtailimages_tags %&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&#123;% for post in blogpages %&#125;</span><br><span class="line">    &#123;% with post=post.specific %&#125;</span><br><span class="line">        &lt;h2&gt;&lt;a href=&quot;&#123;% pageurl post %&#125;&quot;&gt;&#123;&#123; post.title &#125;&#125;&lt;/a&gt;&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &#123;% with post.main_image as main_image %&#125;</span><br><span class="line">            &#123;% if main_image %&#125;&#123;% image main_image fill-160x100 %&#125;&#123;% endif %&#125;</span><br><span class="line">        &#123;% endwith %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;&#123;&#123; post.intro &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &#123;&#123; post.body|richtext &#125;&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标签-amp-分类待后整理"><a href="#标签-amp-分类待后整理" class="headerlink" title="标签&amp;分类待后整理"></a>标签&amp;分类待后整理</h2><h3 id="添加标签"><a href="#添加标签" class="headerlink" title="添加标签"></a>添加标签</h3><p>首先，修改 blog/models.py：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># New imports added for ClusterTaggableManager, TaggedItemBase, MultiFieldPanel</span><br><span class="line"></span><br><span class="line">from modelcluster.fields import ParentalKey</span><br><span class="line">from modelcluster.contrib.taggit import ClusterTaggableManager</span><br><span class="line">from taggit.models import TaggedItemBase</span><br><span class="line"></span><br><span class="line">from wagtail.core.models import Page, Orderable</span><br><span class="line">from wagtail.core.fields import RichTextField</span><br><span class="line">from wagtail.admin.edit_handlers import FieldPanel, InlinePanel, MultiFieldPanel</span><br><span class="line">from wagtail.images.edit_handlers import ImageChooserPanel</span><br><span class="line">from wagtail.search import index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ... (Keep the definition of BlogIndexPage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BlogPageTag(TaggedItemBase):</span><br><span class="line">    content_object = ParentalKey(</span><br><span class="line">        &apos;BlogPage&apos;,</span><br><span class="line">        related_name=&apos;tagged_items&apos;,</span><br><span class="line">        on_delete=models.CASCADE</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BlogPage(Page):</span><br><span class="line">    date = models.DateField(&quot;Post date&quot;)</span><br><span class="line">    intro = models.CharField(max_length=250)</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line">    tags = ClusterTaggableManager(through=BlogPageTag, blank=True)</span><br><span class="line"></span><br><span class="line">    # ... (Keep the main_image method and search_fields definition)</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        MultiFieldPanel([</span><br><span class="line">            FieldPanel(&apos;date&apos;),</span><br><span class="line">            FieldPanel(&apos;tags&apos;),</span><br><span class="line">        ], heading=&quot;Blog information&quot;),</span><br><span class="line">        FieldPanel(&apos;intro&apos;),</span><br><span class="line">        FieldPanel(&apos;body&apos;),</span><br><span class="line">        InlinePanel(&apos;gallery_images&apos;, label=&quot;Gallery images&quot;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>运行以下代码，确保更新</p>
<pre><code>python manage.py makemigrations
python manage.py migrate </code></pre><p>Note the new modelcluster and taggit imports, the addition of a new BlogPageTag model, and the addition of a tags field on BlogPage. We’ve also taken the opportunity to use a MultiFieldPanel in content_panels to group the date and tags fields together for readability.</p>
<p>Edit one of your BlogPage instances, and you should now be able to tag posts:</p>
<p>Tagging a post<br>To render tags on a BlogPage, add this to blog_page.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if page.tags.all.count %&#125;</span><br><span class="line">    &lt;div class=&quot;tags&quot;&gt;</span><br><span class="line">        &lt;h3&gt;Tags&lt;/h3&gt;</span><br><span class="line">        &#123;% for tag in page.tags.all %&#125;</span><br><span class="line">            &lt;a href=&quot;&#123;% slugurl &apos;tags&apos; %&#125;?tag=&#123;&#123; tag &#125;&#125;&quot;&gt;&lt;button type=&quot;button&quot;&gt;&#123;&#123; tag &#125;&#125;&lt;/button&gt;&lt;/a&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>Notice that we’re linking to pages here with the builtin slugurl tag rather than pageurl, which we used earlier. The difference is that slugurl takes a Page slug (from the Promote tab) as an argument. pageurl is more commonly used because it is unambiguous and avoids extra database lookups. But in the case of this loop, the Page object isn’t readily available, so we fall back on the less-preferred slugurl tag.</p>
<p>Visiting a blog post with tags should now show a set of linked buttons at the bottom - one for each tag. However, clicking a button will get you a 404, since we haven’t yet defined a “tags” view. Add to models.py:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class BlogTagIndexPage(Page):</span><br><span class="line"></span><br><span class="line">    def get_context(self, request):</span><br><span class="line"></span><br><span class="line">        # Filter by tag</span><br><span class="line">        tag = request.GET.get(&apos;tag&apos;)</span><br><span class="line">        blogpages = BlogPage.objects.filter(tags__name=tag)</span><br><span class="line"></span><br><span class="line">        # Update template context</span><br><span class="line">        context = super().get_context(request)</span><br><span class="line">        context[&apos;blogpages&apos;] = blogpages</span><br><span class="line">        return context</span><br></pre></td></tr></table></figure>

<p>Note that this Page-based model defines no fields of its own. Even without fields, subclassing Page makes it a part of the Wagtail ecosystem, so that you can give it a title and URL in the admin, and so that you can manipulate its contents by returning a QuerySet from its get_context() method.</p>
<p>Migrate this in, then create a new BlogTagIndexPage in the admin. You’ll probably want to create the new page/view as a child of Homepage, parallel to your Blog index. Give it the slug “tags” on the Promote tab.</p>
<p>Access /tags and Django will tell you what you probably already knew: you need to create a template blog/blog_tag_index_page.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% load wagtailcore_tags %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% if request.GET.tag|length %&#125;</span><br><span class="line">        &lt;h4&gt;Showing pages tagged &quot;&#123;&#123; request.GET.tag &#125;&#125;&quot;&lt;/h4&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% for blogpage in blogpages %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;strong&gt;&lt;a href=&quot;&#123;% pageurl blogpage %&#125;&quot;&gt;&#123;&#123; blogpage.title &#125;&#125;&lt;/a&gt;&lt;/strong&gt;&lt;br /&gt;</span><br><span class="line">            &lt;small&gt;Revised: &#123;&#123; blogpage.latest_revision_created_at &#125;&#125;&lt;/small&gt;&lt;br /&gt;</span><br><span class="line">            &#123;% if blogpage.author %&#125;</span><br><span class="line">                &lt;p&gt;By &#123;&#123; blogpage.author.profile &#125;&#125;&lt;/p&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        No pages found with that tag.</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>We’re calling the built-in latest_revision_created_at field on the Page model - handy to know this is always available.</p>
<p>We haven’t yet added an “author” field to our BlogPage model, nor do we have a Profile model for authors - we’ll leave those as an exercise for the reader.</p>
<p>Clicking the tag button at the bottom of a BlogPost should now render a page something like this:</p>
<p>A simple tag view</p>
<h3 id="添加分类"><a href="#添加分类" class="headerlink" title="添加分类"></a>添加分类</h3><p>Let’s add a category system to our blog. Unlike tags, where a page author can bring a tag into existence simply by using it on a page, our categories will be a fixed list, managed by the site owner through a separate area of the admin interface.</p>
<p>First, we define a BlogCategory model. A category is not a page in its own right, and so we define it as a standard Django models.Model rather than inheriting from Page. Wagtail introduces the concept of “snippets” for reusable pieces of content that need to be managed through the admin interface, but do not exist as part of the page tree themselves; a model can be registered as a snippet by adding the @register_snippet decorator. All the field types we’ve used so far on pages can be used on snippets too - here we’ll give each category an icon image as well as a name. Add to blog/models.py:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from wagtail.snippets.models import register_snippet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@register_snippet</span><br><span class="line">class BlogCategory(models.Model):</span><br><span class="line">    name = models.CharField(max_length=255)</span><br><span class="line">    icon = models.ForeignKey(</span><br><span class="line">        &apos;wagtailimages.Image&apos;, null=True, blank=True,</span><br><span class="line">        on_delete=models.SET_NULL, related_name=&apos;+&apos;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    panels = [</span><br><span class="line">        FieldPanel(&apos;name&apos;),</span><br><span class="line">        ImageChooserPanel(&apos;icon&apos;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural = &apos;blog categories&apos;</span><br></pre></td></tr></table></figure>

<p>Note</p>
<p>Note that we are using panels rather than content_panels here - since snippets generally have no need for fields such as slug or publish date, the editing interface for them is not split into separate ‘content’ / ‘promote’ / ‘settings’ tabs as standard, and so there is no need to distinguish between ‘content panels’ and ‘promote panels’.</p>
<p>Migrate this change in, and create a few categories through the Snippets area which now appears in the admin menu.</p>
<p>We can now add categories to the BlogPage model, as a many-to-many field. The field type we use for this is ParentalManyToManyField - this is a variant of the standard Django ManyToManyField which ensures that the chosen objects are correctly stored against the page record in the revision history, in much the same way that ParentalKey replaces ForeignKey for one-to-many relations.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># New imports added for forms and ParentalManyToManyField</span><br><span class="line">from django import forms</span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">from modelcluster.fields import ParentalKey, ParentalManyToManyField</span><br><span class="line">from modelcluster.contrib.taggit import ClusterTaggableManager</span><br><span class="line">from taggit.models import TaggedItemBase</span><br><span class="line"></span><br><span class="line"># ...</span><br><span class="line"></span><br><span class="line">class BlogPage(Page):</span><br><span class="line">    date = models.DateField(&quot;Post date&quot;)</span><br><span class="line">    intro = models.CharField(max_length=250)</span><br><span class="line">    body = RichTextField(blank=True)</span><br><span class="line">    tags = ClusterTaggableManager(through=BlogPageTag, blank=True)</span><br><span class="line">    categories = ParentalManyToManyField(&apos;blog.BlogCategory&apos;, blank=True)</span><br><span class="line"></span><br><span class="line">    # ... (Keep the main_image method and search_fields definition)</span><br><span class="line"></span><br><span class="line">    content_panels = Page.content_panels + [</span><br><span class="line">        MultiFieldPanel([</span><br><span class="line">            FieldPanel(&apos;date&apos;),</span><br><span class="line">            FieldPanel(&apos;tags&apos;),</span><br><span class="line">            FieldPanel(&apos;categories&apos;, widget=forms.CheckboxSelectMultiple),</span><br><span class="line">        ], heading=&quot;Blog information&quot;),</span><br><span class="line">        FieldPanel(&apos;intro&apos;),</span><br><span class="line">        FieldPanel(&apos;body&apos;),</span><br><span class="line">        InlinePanel(&apos;gallery_images&apos;, label=&quot;Gallery images&quot;),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>Here we’re making use of the widget keyword argument on the FieldPanel definition to specify a checkbox-based widget instead of the default multiple select box, as this is often considered more user-friendly.</p>
<p>Finally, we can update the blog_page.html template to display the categories:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;p class=&quot;meta&quot;&gt;&#123;&#123; page.date &#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&#123;% with categories=page.categories.all %&#125;</span><br><span class="line">    &#123;% if categories %&#125;</span><br><span class="line">        &lt;h3&gt;Posted in:&lt;/h3&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &#123;% for category in categories %&#125;</span><br><span class="line">                &lt;li style=&quot;display: inline&quot;&gt;</span><br><span class="line">                    &#123;% image category.icon fill-32x32 style=&quot;vertical-align: middle&quot; %&#125;</span><br><span class="line">                    &#123;&#123; category.name &#125;&#125;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/wagtail/" rel="tag"># wagtail</a>
          
        </div>
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/2019/11/06/wagtail-1 - 背景及初始配置/" rel="next" title="wagtail-1 - 背景及初始配置">
                <i class="fa fa-chevron-left"></i> wagtail-1 - 背景及初始配置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/2019/11/18/wagtail-3 - 示例网站/" rel="prev" title="wagtail-3 - 示例网站">
                wagtail-3 - 示例网站 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/header.jpg"
      alt="鱼之乐">
  <p class="site-author-name" itemprop="name">鱼之乐</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#修改后台编辑窗口"><span class="nav-number">1.</span> <span class="nav-text">修改后台编辑窗口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改前台展示"><span class="nav-number">2.</span> <span class="nav-text">修改前台展示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单博客网站"><span class="nav-number">3.</span> <span class="nav-text">简单博客网站</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#博客首页"><span class="nav-number">3.1.</span> <span class="nav-text">博客首页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发布文章页面"><span class="nav-number">3.2.</span> <span class="nav-text">发布文章页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#排序和发布"><span class="nav-number">3.3.</span> <span class="nav-text">排序和发布</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图片支持"><span class="nav-number">4.</span> <span class="nav-text">图片支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标签-amp-分类待后整理"><span class="nav-number">5.</span> <span class="nav-text">标签&amp;分类待后整理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加标签"><span class="nav-number">5.1.</span> <span class="nav-text">添加标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加分类"><span class="nav-number">5.2.</span> <span class="nav-text">添加分类</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">鱼之乐</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>






  




























  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


    

<script>
NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.3.9/dist/Valine.min.js', function() {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'mIurV7uFOMOsJATnr1Jl8nDF-MdYXbMMI',
    appKey: 'UaWiXs6KzlY3Je9Y6FM6SKji',
    placeholder: '感谢您的真知灼见',
    avatar: 'mm',
    meta: guest,
    pageSize: '5' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
